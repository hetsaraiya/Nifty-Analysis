2025-06-15 14:48:53 | ERROR | fastapi_app:get_option_chain:611 | Unexpected error in option chain API: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:48:53 | ERROR | fastapi_app:get_option_chain:612 | Full traceback for option chain API error
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 10
               └ <function _main at 0x7fa54f580ae0>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fa54f688680>
           └ <SpawnProcess name='SpawnProcess-5' parent=67047 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fa54f653ba0>
    └ <SpawnProcess name='SpawnProcess-5' parent=67047 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fa54e75eba0>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-5' parent=67047 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-5' parent=67047 started>
    │    └ <function subprocess_started at 0x7fa54e8c4180>
    └ <SpawnProcess name='SpawnProcess-5' parent=67047 started>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fa54e75ecf0>>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x7fa54e8af240>
           │       │   └ <uvicorn.server.Server object at 0x7fa54e75ecf0>
           │       └ <function run at 0x7fa54f5823e0>
           └ <module 'asyncio' from '/usr/lib/python3.13/asyncio/__init__.py'>
  File "/usr/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7fa54e6152a0>
           │      └ <function Runner.run at 0x7fa54ea3eac0>
           └ <asyncio.runners.Runner object at 0x7fa54e75f620>
  File "/usr/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /home/het/.local/lib/python3.13/site-packages/uvicorn/server.py:7...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7fa54e65eb50>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fa54e75f620>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7fa51a7d79c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a7d76a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7fa51a5bc2f0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7fa51a5bc440>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7fa51a7d79c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a7d76a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fa51a5bc1a0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7fa51a5bc2f0>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7fa51a7d79c0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a7d76a0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x7fa51a5be3c0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x7fa51a72bc50>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fa51a5bc1a0>
          └ <function wrap_app_handling_exceptions at 0x7fa54d4ec220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa51a606e80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a7d76a0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x7fa51a72bc50>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa51a606e80>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a7d76a0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x7fa51a72bc50>>
          └ <fastapi.routing.APIRouter object at 0x7fa51a72bc50>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa51a606e80>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a7d76a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x7fa54d4ed8a0>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa51a606e80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a7d76a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fa51a7d7ba0>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa51a606e80>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a7d76a0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x7fa51a7e2e90>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x7fa51a606f20>
          └ <function wrap_app_handling_exceptions at 0x7fa54d4ec220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa51a607060>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a7d76a0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x7fa51a606f20>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x7fa51a7e2e90>
                     └ <function get_request_handler.<locals>.app at 0x7fa51a7d7a60>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fa54d4d39c0>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_option_chain at 0x7fa51a7d6160>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[], security_requ...

> File "/home/het/Desktop/Nifty Analysis/fastapi_app.py", line 595, in get_option_chain
    'data_timestamp': datetime.now().isoformat(),
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:49:54 | ERROR | fastapi_app:get_option_chain:611 | Unexpected error in option chain API: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:49:54 | ERROR | fastapi_app:get_option_chain:612 | Full traceback for option chain API error
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 10
               └ <function _main at 0x7fa54f580ae0>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fa54f688680>
           └ <SpawnProcess name='SpawnProcess-5' parent=67047 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fa54f653ba0>
    └ <SpawnProcess name='SpawnProcess-5' parent=67047 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fa54e75eba0>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-5' parent=67047 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-5' parent=67047 started>
    │    └ <function subprocess_started at 0x7fa54e8c4180>
    └ <SpawnProcess name='SpawnProcess-5' parent=67047 started>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fa54e75ecf0>>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x7fa54e8af240>
           │       │   └ <uvicorn.server.Server object at 0x7fa54e75ecf0>
           │       └ <function run at 0x7fa54f5823e0>
           └ <module 'asyncio' from '/usr/lib/python3.13/asyncio/__init__.py'>
  File "/usr/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7fa54e6152a0>
           │      └ <function Runner.run at 0x7fa54ea3eac0>
           └ <asyncio.runners.Runner object at 0x7fa54e75f620>
  File "/usr/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /home/het/.local/lib/python3.13/site-packages/uvicorn/server.py:7...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7fa54e65eb50>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fa54e75f620>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7fa51a6536a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a653880>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7fa51a5bc2f0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7fa51a5bc440>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7fa51a6536a0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a653880>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fa51a5bc1a0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7fa51a5bc2f0>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7fa51a6536a0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a653880>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x7fa51a5a0640>
          │                            │    └ <fastapi.routing.APIRouter object at 0x7fa51a72bc50>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fa51a5bc1a0>
          └ <function wrap_app_handling_exceptions at 0x7fa54d4ec220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa51a6539c0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a653880>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x7fa51a72bc50>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa51a6539c0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a653880>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x7fa51a72bc50>>
          └ <fastapi.routing.APIRouter object at 0x7fa51a72bc50>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa51a6539c0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a653880>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x7fa54d4ed8a0>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa51a6539c0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a653880>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fa51a7d7ba0>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa51a6539c0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a653880>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x7fa51a5a1350>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x7fa51a653a60>
          └ <function wrap_app_handling_exceptions at 0x7fa54d4ec220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa51a653ba0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa51a653880>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x7fa51a653a60>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x7fa51a5a1350>
                     └ <function get_request_handler.<locals>.app at 0x7fa51a7d7a60>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fa54d4d39c0>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_option_chain at 0x7fa51a7d6160>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[], security_requ...

> File "/home/het/Desktop/Nifty Analysis/fastapi_app.py", line 595, in get_option_chain
    'data_timestamp': datetime.now().isoformat(),
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:50:58 | ERROR | fastapi_app:get_option_chain:667 | Unexpected error in option chain API: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:50:58 | ERROR | fastapi_app:get_option_chain:668 | Full traceback for option chain API error
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 10
               └ <function _main at 0x7fb7bc768ae0>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fb7bc888680>
           └ <SpawnProcess name='SpawnProcess-6' parent=67047 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fb7bc853ba0>
    └ <SpawnProcess name='SpawnProcess-6' parent=67047 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fb7bb95eba0>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-6' parent=67047 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-6' parent=67047 started>
    │    └ <function subprocess_started at 0x7fb7bbac4180>
    └ <SpawnProcess name='SpawnProcess-6' parent=67047 started>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fb7bb95ecf0>>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x7fb7bbaaf240>
           │       │   └ <uvicorn.server.Server object at 0x7fb7bb95ecf0>
           │       └ <function run at 0x7fb7bc76a3e0>
           └ <module 'asyncio' from '/usr/lib/python3.13/asyncio/__init__.py'>
  File "/usr/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7fb7bb8152a0>
           │      └ <function Runner.run at 0x7fb7bbc3eac0>
           └ <asyncio.runners.Runner object at 0x7fb7bb95f620>
  File "/usr/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /home/het/.local/lib/python3.13/site-packages/uvicorn/server.py:7...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7fb7bb85eb50>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fb7bb95f620>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7fb7879db7e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fb7879d9ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7fb7877c02f0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7fb7877c0440>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7fb7879db7e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fb7879d9ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fb7877c01a0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7fb7877c02f0>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7fb7879db7e0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fb7879d9ee0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x7fb7877c23c0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x7fb787933c50>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fb7877c01a0>
          └ <function wrap_app_handling_exceptions at 0x7fb7ba6f4220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fb78780af20>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fb7879d9ee0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x7fb787933c50>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fb78780af20>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fb7879d9ee0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x7fb787933c50>>
          └ <fastapi.routing.APIRouter object at 0x7fb787933c50>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fb78780af20>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fb7879d9ee0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x7fb7ba6f58a0>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fb78780af20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fb7879d9ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fb7879dbc40>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fb78780af20>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fb7879d9ee0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x7fb7879e6e90>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x7fb78780afc0>
          └ <function wrap_app_handling_exceptions at 0x7fb7ba6f4220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fb78780b100>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fb7879d9ee0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x7fb78780afc0>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x7fb7879e6e90>
                     └ <function get_request_handler.<locals>.app at 0x7fb7879dbb00>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fb7ba6d79c0>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_option_chain at 0x7fb7879da0c0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[], security_requ...

> File "/home/het/Desktop/Nifty Analysis/fastapi_app.py", line 651, in get_option_chain
    'data_timestamp': datetime.now().isoformat(),
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:51:53 | ERROR | fastapi_app:get_option_chain:721 | Unexpected error in option chain API: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:51:53 | ERROR | fastapi_app:get_option_chain:722 | Full traceback for option chain API error
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f836b380ae0>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f836b488680>
           └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f836b453ba0>
    └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f836a55eba0>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
    │    └ <function subprocess_started at 0x7f836a6c4180>
    └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f836a55ecf0>>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x7f836a6af240>
           │       │   └ <uvicorn.server.Server object at 0x7f836a55ecf0>
           │       └ <function run at 0x7f836b3823e0>
           └ <module 'asyncio' from '/usr/lib/python3.13/asyncio/__init__.py'>
  File "/usr/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7f836a4152a0>
           │      └ <function Runner.run at 0x7f836a842ac0>
           └ <asyncio.runners.Runner object at 0x7f836a55f620>
  File "/usr/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /home/het/.local/lib/python3.13/site-packages/uvicorn/server.py:7...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7f836a45ab50>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f836a55f620>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f83365d37e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f83363b42f0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f83363b4440>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f83365d37e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f83363b41a0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f83363b42f0>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f83365d37e0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x7f83363b63c0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f83363b41a0>
          └ <function wrap_app_handling_exceptions at 0x7f83692f4220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336406f20>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336406f20>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x7f83365e4050>>
          └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336406f20>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x7f83692f58a0>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336406f20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f83365d3c40>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336406f20>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x7f83365e7b10>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x7f8336406fc0>
          └ <function wrap_app_handling_exceptions at 0x7f83692f4220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336407100>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x7f8336406fc0>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x7f83365e7b10>
                     └ <function get_request_handler.<locals>.app at 0x7f83365d3b00>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f83692d39c0>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_option_chain at 0x7f83365d20c0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[], security_requ...

> File "/home/het/Desktop/Nifty Analysis/fastapi_app.py", line 705, in get_option_chain
    'data_timestamp': datetime.now().isoformat(),
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:51:54 | ERROR | fastapi_app:get_option_chain:721 | Unexpected error in option chain API: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:51:54 | ERROR | fastapi_app:get_option_chain:722 | Full traceback for option chain API error
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f836b380ae0>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f836b488680>
           └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f836b453ba0>
    └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f836a55eba0>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
    │    └ <function subprocess_started at 0x7f836a6c4180>
    └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f836a55ecf0>>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x7f836a6af240>
           │       │   └ <uvicorn.server.Server object at 0x7f836a55ecf0>
           │       └ <function run at 0x7f836b3823e0>
           └ <module 'asyncio' from '/usr/lib/python3.13/asyncio/__init__.py'>
  File "/usr/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7f836a4152a0>
           │      └ <function Runner.run at 0x7f836a842ac0>
           └ <asyncio.runners.Runner object at 0x7f836a55f620>
  File "/usr/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /home/het/.local/lib/python3.13/site-packages/uvicorn/server.py:7...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7f836a45ab50>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f836a55f620>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f836b488c20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f836b488cc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f83363b42f0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f83363b4440>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f836b488c20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f836b488cc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f83363b41a0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f83363b42f0>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f836b488c20>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f836b488cc0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x7f83363d5b50>
          │                            │    └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f83363b41a0>
          └ <function wrap_app_handling_exceptions at 0x7f83692f4220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336447a60>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f836b488cc0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336447a60>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f836b488cc0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x7f83365e4050>>
          └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336447a60>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f836b488cc0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x7f83692f58a0>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336447a60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f836b488cc0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f83365d3c40>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336447a60>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f836b488cc0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x7f83363d5e50>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x7f8336447880>
          └ <function wrap_app_handling_exceptions at 0x7f83692f4220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336447ba0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f836b488cc0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x7f8336447880>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x7f83363d5e50>
                     └ <function get_request_handler.<locals>.app at 0x7f83365d3b00>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f83692d39c0>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_option_chain at 0x7f83365d20c0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[], security_requ...

> File "/home/het/Desktop/Nifty Analysis/fastapi_app.py", line 705, in get_option_chain
    'data_timestamp': datetime.now().isoformat(),
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:52:12 | ERROR | fastapi_app:get_option_chain:721 | Unexpected error in option chain API: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:52:12 | ERROR | fastapi_app:get_option_chain:722 | Full traceback for option chain API error
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f836b380ae0>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f836b488680>
           └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f836b453ba0>
    └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f836a55eba0>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
    │    └ <function subprocess_started at 0x7f836a6c4180>
    └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f836a55ecf0>>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x7f836a6af240>
           │       │   └ <uvicorn.server.Server object at 0x7f836a55ecf0>
           │       └ <function run at 0x7f836b3823e0>
           └ <module 'asyncio' from '/usr/lib/python3.13/asyncio/__init__.py'>
  File "/usr/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7f836a4152a0>
           │      └ <function Runner.run at 0x7f836a842ac0>
           └ <asyncio.runners.Runner object at 0x7f836a55f620>
  File "/usr/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /home/het/.local/lib/python3.13/site-packages/uvicorn/server.py:7...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7f836a45ab50>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f836a55f620>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f83365d3740>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f83363b42f0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f83363b4440>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f83365d3740>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f83363b41a0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f83363b42f0>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f83365d3740>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x7f833646b4d0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f83363b41a0>
          └ <function wrap_app_handling_exceptions at 0x7f83692f4220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336406f20>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336406f20>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x7f83365e4050>>
          └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336406f20>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x7f83692f58a0>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336406f20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f83365d3c40>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336406f20>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x7f833647bc70>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x7f8336407100>
          └ <function wrap_app_handling_exceptions at 0x7f83692f4220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8336445bc0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f83365d1ee0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x7f8336407100>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x7f833647bc70>
                     └ <function get_request_handler.<locals>.app at 0x7f83365d3b00>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f83692d39c0>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_option_chain at 0x7f83365d20c0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[], security_requ...

> File "/home/het/Desktop/Nifty Analysis/fastapi_app.py", line 705, in get_option_chain
    'data_timestamp': datetime.now().isoformat(),
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:52:23 | ERROR | fastapi_app:get_option_chain:721 | Unexpected error in option chain API: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:52:23 | ERROR | fastapi_app:get_option_chain:722 | Full traceback for option chain API error
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f836b380ae0>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f836b488680>
           └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f836b453ba0>
    └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f836a55eba0>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
    │    └ <function subprocess_started at 0x7f836a6c4180>
    └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f836a55ecf0>>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x7f836a6af240>
           │       │   └ <uvicorn.server.Server object at 0x7f836a55ecf0>
           │       └ <function run at 0x7f836b3823e0>
           └ <module 'asyncio' from '/usr/lib/python3.13/asyncio/__init__.py'>
  File "/usr/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7f836a4152a0>
           │      └ <function Runner.run at 0x7f836a842ac0>
           └ <asyncio.runners.Runner object at 0x7f836a55f620>
  File "/usr/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /home/het/.local/lib/python3.13/site-packages/uvicorn/server.py:7...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7f836a45ab50>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f836a55f620>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f833636cea0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636cfe0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f83363b42f0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f83363b4440>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f833636cea0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636cfe0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f83363b41a0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f83363b42f0>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f833636cea0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636cfe0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x7f8336370590>
          │                            │    └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f83363b41a0>
          └ <function wrap_app_handling_exceptions at 0x7f83692f4220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f833636d260>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636cfe0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f833636d260>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636cfe0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x7f83365e4050>>
          └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f833636d260>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636cfe0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x7f83692f58a0>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f833636d260>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636cfe0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f83365d3c40>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f833636d260>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636cfe0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x7f83363df490>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x7f833636d300>
          └ <function wrap_app_handling_exceptions at 0x7f83692f4220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f833636d440>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636cfe0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x7f833636d300>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x7f83363df490>
                     └ <function get_request_handler.<locals>.app at 0x7f83365d3b00>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f83692d39c0>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_option_chain at 0x7f83365d20c0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[], security_requ...

> File "/home/het/Desktop/Nifty Analysis/fastapi_app.py", line 705, in get_option_chain
    'data_timestamp': datetime.now().isoformat(),
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:52:24 | ERROR | fastapi_app:get_option_chain:721 | Unexpected error in option chain API: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:52:24 | ERROR | fastapi_app:get_option_chain:722 | Full traceback for option chain API error
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f836b380ae0>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f836b488680>
           └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f836b453ba0>
    └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f836a55eba0>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
    │    └ <function subprocess_started at 0x7f836a6c4180>
    └ <SpawnProcess name='SpawnProcess-1' parent=69422 started>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f836a55ecf0>>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x7f836a6af240>
           │       │   └ <uvicorn.server.Server object at 0x7f836a55ecf0>
           │       └ <function run at 0x7f836b3823e0>
           └ <module 'asyncio' from '/usr/lib/python3.13/asyncio/__init__.py'>
  File "/usr/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7f836a4152a0>
           │      └ <function Runner.run at 0x7f836a842ac0>
           └ <asyncio.runners.Runner object at 0x7f836a55f620>
  File "/usr/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /home/het/.local/lib/python3.13/site-packages/uvicorn/server.py:7...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7f836a45ab50>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f836a55f620>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f833636d620>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636d800>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f83363b42f0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f83363b4440>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f833636d620>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636d800>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f83363b41a0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f83363b42f0>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f833636d620>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636d800>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x7f83363df6a0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f83363b41a0>
          └ <function wrap_app_handling_exceptions at 0x7f83692f4220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f833636d940>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636d800>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f833636d940>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636d800>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x7f83365e4050>>
          └ <fastapi.routing.APIRouter object at 0x7f83365e4050>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f833636d940>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636d800>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x7f83692f58a0>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f833636d940>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636d800>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f83365d3c40>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f833636d940>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636d800>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x7f83363df280>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x7f833636d9e0>
          └ <function wrap_app_handling_exceptions at 0x7f83692f4220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f833636db20>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f833636d800>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x7f833636d9e0>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x7f83363df280>
                     └ <function get_request_handler.<locals>.app at 0x7f83365d3b00>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f83692d39c0>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_option_chain at 0x7f83365d20c0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[], security_requ...

> File "/home/het/Desktop/Nifty Analysis/fastapi_app.py", line 705, in get_option_chain
    'data_timestamp': datetime.now().isoformat(),
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:52:54 | ERROR | fastapi_app:get_option_chain:721 | Unexpected error in option chain API: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:52:54 | ERROR | fastapi_app:get_option_chain:722 | Full traceback for option chain API error
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 10
               └ <function _main at 0x7f8adc834ae0>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f8adc988680>
           └ <SpawnProcess name='SpawnProcess-2' parent=69422 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f8adc953ba0>
    └ <SpawnProcess name='SpawnProcess-2' parent=69422 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f8adbab2ba0>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-2' parent=69422 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-2' parent=69422 started>
    │    └ <function subprocess_started at 0x7f8adbc14180>
    └ <SpawnProcess name='SpawnProcess-2' parent=69422 started>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f8adbab2cf0>>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x7f8adbbff240>
           │       │   └ <uvicorn.server.Server object at 0x7f8adbab2cf0>
           │       └ <function run at 0x7f8adc8363e0>
           └ <module 'asyncio' from '/usr/lib/python3.13/asyncio/__init__.py'>
  File "/usr/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7f8adb9052a0>
           │      └ <function Runner.run at 0x7f8adbda6ac0>
           └ <asyncio.runners.Runner object at 0x7f8adbab3620>
  File "/usr/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /home/het/.local/lib/python3.13/site-packages/uvicorn/server.py:7...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7f8adb94ab50>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f8adbab3620>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f8aa848b7e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f8aa8489ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7f8aa78e02f0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7f8aa78e0440>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f8aa848b7e0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f8aa8489ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f8aa78e01a0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7f8aa78e02f0>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7f8aa848b7e0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f8aa8489ee0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x7f8aa78e23c0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x7f8aa83dfc50>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f8aa78e01a0>
          └ <function wrap_app_handling_exceptions at 0x7f8ada568220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8aa792ef20>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f8aa8489ee0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x7f8aa83dfc50>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8aa792ef20>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f8aa8489ee0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x7f8aa83dfc50>>
          └ <fastapi.routing.APIRouter object at 0x7f8aa83dfc50>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8aa792ef20>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f8aa8489ee0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x7f8ada5698a0>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8aa792ef20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f8aa8489ee0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f8aa848bc40>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8aa792ef20>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f8aa8489ee0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x7f8aa788ee90>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x7f8aa792efc0>
          └ <function wrap_app_handling_exceptions at 0x7f8ada568220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7f8aa792f100>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7f8aa8489ee0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x7f8aa792efc0>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x7f8aa788ee90>
                     └ <function get_request_handler.<locals>.app at 0x7f8aa848bb00>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f8ada80f9c0>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_option_chain at 0x7f8aa848a0c0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[], security_requ...

> File "/home/het/Desktop/Nifty Analysis/fastapi_app.py", line 705, in get_option_chain
    'data_timestamp': datetime.now().isoformat(),
                      └ <module 'datetime' from '/usr/lib/python3.13/datetime.py'>

UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:52:59 | ERROR | fastapi_app:get_option_chain:721 | Unexpected error in option chain API: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 14:52:59 | ERROR | fastapi_app:get_option_chain:722 | Full traceback for option chain API error
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 10
               └ <function _main at 0x7fa306068ae0>
  File "/usr/lib/python3.13/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fa306188680>
           └ <SpawnProcess name='SpawnProcess-3' parent=69422 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fa306153ba0>
    └ <SpawnProcess name='SpawnProcess-3' parent=69422 started>
  File "/usr/lib/python3.13/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fa3052f2ba0>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=69422 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=69422 started>
    │    └ <function subprocess_started at 0x7fa305454180>
    └ <SpawnProcess name='SpawnProcess-3' parent=69422 started>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fa3052f2cf0>>
  File "/home/het/.local/lib/python3.13/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x7fa30543f240>
           │       │   └ <uvicorn.server.Server object at 0x7fa3052f2cf0>
           │       └ <function run at 0x7fa30606a3e0>
           └ <module 'asyncio' from '/usr/lib/python3.13/asyncio/__init__.py'>
  File "/usr/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x7fa3051452a0>
           │      └ <function Runner.run at 0x7fa3055c6ac0>
           └ <asyncio.runners.Runner object at 0x7fa3052f3620>
  File "/usr/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /home/het/.local/lib/python3.13/site-packages/uvicorn/server.py:7...
           │    │     └ <cyfunction Loop.run_until_complete at 0x7fa30518ab50>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fa3052f3620>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7fa2d1c43740>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa2d1c436a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x7fa2d10c82f0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x7fa2d10c8440>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7fa2d1c43740>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa2d1c436a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fa2d10c81a0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x7fa2d10c82f0>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x7fa2d1c43740>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa2d1c436a0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x7fa2d10ca3c0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x7fa2d1b9bc50>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fa2d10c81a0>
          └ <function wrap_app_handling_exceptions at 0x7fa303e08220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa2d1112fc0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa2d1c436a0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x7fa2d1b9bc50>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa2d1112fc0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa2d1c436a0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x7fa2d1b9bc50>>
          └ <fastapi.routing.APIRouter object at 0x7fa2d1b9bc50>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa2d1112fc0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa2d1c436a0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x7fa303e098a0>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa2d1112fc0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa2d1c436a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fa2d1c43c40>
          └ APIRoute(path='/api/option-chain', name='get_option_chain', methods=['GET'])
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa2d1112fc0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa2d1c436a0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x7fa2d1c52e90>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x7fa2d1113060>
          └ <function wrap_app_handling_exceptions at 0x7fa303e08220>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x7fa2d11131a0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x7fa2d1c436a0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x7fa2d1113060>
  File "/home/het/.local/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x7fa2d1c52e90>
                     └ <function get_request_handler.<locals>.app at 0x7fa2d1c43b00>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fa303feb9c0>
  File "/home/het/.local/lib/python3.13/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_option_chain at 0x7fa2d1c420c0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[], security_requ...

> File "/home/het/Desktop/Nifty Analysis/fastapi_app.py", line 705, in get_option_chain
    'data_timestamp': datetime.now().isoformat(),
                      └ <module 'datetime' from '/usr/lib/python3.13/datetime.py'>

UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value
2025-06-15 15:03:25 | ERROR | fastapi_app:get_option_chain:663 | No valid authentication or API connection available
2025-06-15 15:30:49 | ERROR | yahoo_nifty_greeks:analyze_options_chain:447 | Error analyzing options chain: single positional indexer is out-of-bounds
2025-06-15 16:00:10 | ERROR | fastapi_yahoo:generate_options_chain:310 | Error generating options chain: NiftyOptionsChain.generate_options_chain() got an unexpected keyword argument 'atm_only'
2025-06-15 16:52:50 | ERROR | fastapi_yahoo:generate_options_chain:339 | Error generating options chain: name 'market_enhancer' is not defined
2025-06-15 16:53:50 | ERROR | real_oi_fetcher:fetch_nifty_option_chain:77 | NSE API returned status code: 401
2025-06-15 16:53:50 | ERROR | real_oi_fetcher:get_real_option_chain_data:190 | Failed to fetch NSE data
2025-06-15 16:54:51 | ERROR | real_oi_fetcher:fetch_nifty_option_chain:77 | NSE API returned status code: 401
2025-06-15 16:54:51 | ERROR | real_oi_fetcher:get_real_option_chain_data:190 | Failed to fetch NSE data
2025-06-15 16:56:53 | ERROR | real_oi_fetcher:fetch_nifty_option_chain:77 | NSE API returned status code: 401
2025-06-15 16:56:53 | ERROR | real_oi_fetcher:get_real_option_chain_data:190 | Failed to fetch NSE data
2025-06-15 17:00:51 | ERROR | real_oi_fetcher:fetch_nifty_option_chain:77 | NSE API returned status code: 401
2025-06-15 17:00:51 | ERROR | real_oi_fetcher:get_real_option_chain_data:190 | Failed to fetch NSE data
2025-06-15 17:00:51 | ERROR | fastapi_yahoo:get_real_oi_data:666 | Failed to fetch real data: Failed to fetch real market data from NSE
2025-06-15 17:00:54 | ERROR | real_oi_fetcher:fetch_nifty_option_chain:77 | NSE API returned status code: 401
2025-06-15 17:00:54 | ERROR | real_oi_fetcher:get_real_option_chain_data:190 | Failed to fetch NSE data
2025-06-15 17:00:59 | ERROR | real_oi_fetcher:fetch_nifty_option_chain:77 | NSE API returned status code: 401
2025-06-15 17:00:59 | ERROR | real_oi_fetcher:get_real_option_chain_data:190 | Failed to fetch NSE data
2025-06-15 17:00:59 | ERROR | fastapi_yahoo:get_real_oi_data:666 | Failed to fetch real data: Failed to fetch real market data from NSE
2025-06-15 17:01:24 | ERROR | real_oi_fetcher:fetch_nifty_option_chain:77 | NSE API returned status code: 401
2025-06-15 17:01:24 | ERROR | real_oi_fetcher:get_real_option_chain_data:190 | Failed to fetch NSE data
2025-06-15 17:01:54 | ERROR | real_oi_fetcher:fetch_nifty_option_chain:77 | NSE API returned status code: 401
2025-06-15 17:01:54 | ERROR | real_oi_fetcher:get_real_option_chain_data:190 | Failed to fetch NSE data
2025-06-15 17:02:24 | ERROR | real_oi_fetcher:fetch_nifty_option_chain:77 | NSE API returned status code: 401
2025-06-15 17:02:24 | ERROR | real_oi_fetcher:get_real_option_chain_data:190 | Failed to fetch NSE data
